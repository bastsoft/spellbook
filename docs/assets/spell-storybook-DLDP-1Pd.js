import{S as b}from"./spell-item-CY5g3-JZ.js";import{T as S}from"./tree-view-BEqjVU0X.js";import{S as T}from"./storybook-remoute-D_5Y4SCo.js";import{s as O}from"./spell-markup-YQHFLX9m.js";import{B as V}from"./button-vb6-B3dMoNTe.js";import{c as I,a as y,b as E,d as f,w as g,r as j,F as x,e as c,o as U,f as B}from"./vue.esm-bundler-BeytHvJU.js";import{_ as w}from"./_plugin-vue_export-helper-DlAUqK2U.js";let u=new T;const h={name:"SpellStorybook",components:{SpellItem:b,TreeView:S,ButtonVb6:V},props:{modelValue:{type:Object,default:()=>({})},storyUrl:{type:String,default:""},storyTestId:{type:String,default:""}},data:()=>({presets:{},entriesTree:{},argTypes:{},slotTypes:{},subArr:[],subArrIndex:null}),computed:{testId:{get(){return this.storyTestId},set(t){this.$emit("update:storyTestId",t)}},url:{get(){return this.storyUrl},set(t){this.$emit("update:storyUrl",t)}},spell:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}}},mounted(){this.storyUrl&&this.onLoad()},methods:{onLoad(){u.loadStorybokIndex(this.url).then(()=>{this.entriesTree=u.getOnlyStoryFromEntriesTree()})},onSelectedElement(t){this.argTypes={},this.presets={};let a=null;u.getOnlyStoryFromEntries().forEach(l=>{const o=l.title.split("/");t.tag===o[o.length-1]&&(a=l.importPath)}),a&&u.importFn(a).then(l=>{const o=l.default.title.split("/").pop();this.argTypes=l.default.argTypes,this.slotTypes=(l.default.parameters||{}).slots;const i=Object.keys(l).filter(n=>!["default","__namedExportsOrder"].includes(n));this.presets=i.reduce((n,d)=>(n[d]={tag:o,render:l[d].render,args:l[d].args||{},argTypes:l[d].argTypes},n),{})}).catch(()=>{console.error("ошибка загрузки пробуем еще раз"),this.onSelectedElement(t)})},onSelectPreset(t){const a=function(e,s){for(let r in s)Object.prototype.hasOwnProperty.call(s,r)&&(typeof s[r]=="object"&&s[r]!==null?(e[r]||(e[r]=Array.isArray(s[r])?[]:{}),a(e[r],s[r])):e[r]=s[r]);return e},l=e=>e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),o=this.presets[t],i={tag:o.tag,argsBinded:[],args:o.argTypes?{}:o.args,slots:{}};let n="",d={},m=JSON.parse(JSON.stringify(o.args));if(o.argTypes&&Object.keys(o.argTypes).forEach(e=>{m[e]=window.prompt(o.argTypes[e].description,m[e])}),o.render){const e=o.render(m);console.log("renderObj : ",e);const s=O.parse(e.template.replace('v-bind="args"',""));e.data&&typeof e.data=="function"&&(n=JSON.stringify(e.data())),e.data&&typeof e.data=="object"&&(n=JSON.stringify(e.data)),e.methods&&Object.keys(e.methods).length&&Object.keys(e.methods).forEach(p=>{d[p]=l(e.methods[p].toString())}),["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","activated","deactivated","beforeUnmount","unmounted"].forEach(p=>{e[p]&&(d[p]=l(e[p].toString()))});let r=s[0];r.tag!==o.tag&&r.slots.default.children[0].tag===o.tag&&(r=r.slots.default.children[0]),i.args={...r.args,...i.args},i.argsBinded=r.argsBinded,i.slots=r.slots}if(this.subArr[this.subArrIndex]=i,n&&confirm("расширить idata?")){const e=new Function(["payload"]," return "+n)();let s=new Function(["payload"]," return "+(this.spell.idata||"{}"))();s=a(s,e),this.spell.idata=JSON.stringify(s,null,2)}d&&confirm("расширить actions?")&&Object.keys(d).forEach(e=>{this.spell.actions[e]||(this.spell.actions[e]=d[e])}),this.$refs.SpellItem.onChange()},goTestBase64(){const a=`${this.url}iframe.html?id=${this.storyTestId}&viewMode=story&args=base64:`;this.$emit("test",a)}}},A={style:{display:"flex",gap:"10px",margin:"20px 10px"}};function k(t,a,l,o,i,n){const d=c("ButtonVb6"),m=c("TreeView"),e=c("SpellItem");return U(),I(x,null,[y("",!0),E("div",A,[f(d,{onClick:n.goTestBase64},{default:g(()=>[B("base64")]),_:1},8,["onClick"]),j(t.$slots,"default")]),f(e,{ref:"SpellItem",modelValue:n.spell,"onUpdate:modelValue":a[2]||(a[2]=s=>n.spell=s),arr:t.subArr,"onUpdate:arr":a[3]||(a[3]=s=>t.subArr=s),index:t.subArrIndex,"onUpdate:index":a[4]||(a[4]=s=>t.subArrIndex=s),"onUpdate:selectedElement":n.onSelectedElement,onSelectPreset:n.onSelectPreset,argTypes:t.argTypes,slotTypes:t.slotTypes,presets:Object.keys(t.presets)},{toolbar:g(({onSelectValueTree:s})=>[f(m,{children:(t.entriesTree||{}).children||{},onSelect:s},null,8,["children","onSelect"])]),_:1},8,["modelValue","arr","index","onUpdate:selectedElement","onSelectPreset","argTypes","slotTypes","presets"]),y("",!0)],64)}const J=w(h,[["render",k]]);h.__docgenInfo={displayName:"SpellStorybook",exportName:"default",description:"",tags:{},props:[{name:"modelValue",type:{name:"object"},defaultValue:{func:!1,value:"{}"}},{name:"storyUrl",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"storyTestId",type:{name:"string"},defaultValue:{func:!1,value:"''"}}],events:[{name:"update:storyTestId",type:{names:["undefined"]}},{name:"update:storyUrl",type:{names:["undefined"]}},{name:"update:modelValue",type:{names:["undefined"]}},{name:"test",type:{names:["undefined"]}}],slots:[{name:"default"}],sourceFiles:["/Users/petr/project/zaymigo/spellbook/src/components/spell-storybook/spell-storybook.vue"]};export{J as S};
